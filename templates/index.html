<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quantum X Terminal</title>

<script src="https://cdn.jsdelivr.net/npm/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

<style>

body{
    margin:0;
    font-family:'Inter',sans-serif;
    background: radial-gradient(circle at top,#0f172a,#020617);
    color:white;
}

header{
    text-align:center;
    padding:25px;
    font-size:28px;
    font-weight:600;
    background:linear-gradient(90deg,#06b6d4,#7c3aed,#3b82f6);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent;
    animation: glow 3s infinite alternate;
}

@keyframes glow{
    from{filter:drop-shadow(0 0 5px #06b6d4);}
    to{filter:drop-shadow(0 0 20px #7c3aed);}
}

.section{padding:20px;text-align:center;}

.button{
    padding:10px 18px;
    border-radius:14px;
    border:none;
    margin:6px;
    background:linear-gradient(45deg,#06b6d4,#3b82f6);
    color:white;
    cursor:pointer;
    transition:0.3s;
}

.button:hover{
    transform:scale(1.1);
    box-shadow:0 0 20px #06b6d4;
}

.input{
    padding:10px;
    border-radius:12px;
    border:none;
    background:rgba(255,255,255,0.08);
    color:white;
    margin:6px;
}

.grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(350px,1fr));
    gap:25px;
    padding:25px;
}

.card{
    background:rgba(255,255,255,0.05);
    backdrop-filter:blur(20px);
    border-radius:20px;
    padding:20px;
    border:1px solid rgba(255,255,255,0.15);
    transition:0.4s;
    position:relative;
    overflow:hidden;
}

.card:hover{
    transform:translateY(-8px);
    box-shadow:0 0 30px rgba(0,255,255,0.4);
}

.chart-container{
    height:150px;
    margin-top:15px;
}

.dashboard{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
    gap:20px;
}

.metric{
    background:rgba(255,255,255,0.07);
    padding:20px;
    border-radius:18px;
    text-align:center;
}

.badge{
    padding:10px 20px;
    border-radius:16px;
    font-weight:600;
}

.Platinum{background:#e5e4e2;color:black;}
.Gold{background:#facc15;color:black;}
.Silver{background:#94a3b8;color:black;}
.Bronze{background:#b45309;color:white;}

</style>
</head>

<body>

<header>Quantum X Institutional Terminal</header>

<div class="section">

<button class="button" onclick="generate()">Generate Trades</button>
<button class="button" onclick="loadAnalytics()">Dashboard</button>

</div>

<div id="output" class="grid"></div>
<div id="dashboard" class="section"></div>

<script>

async function generate(){

    const res=await fetch('/api/scan');
    const data=await res.json();

    const container=document.getElementById("output");
    container.innerHTML="";

    if(!data.results){
        container.innerHTML="<div class='card'>No Trades Found</div>";
        return;
    }

    data.results.forEach((t,i)=>{

        const card=document.createElement("div");
        card.className="card";
        card.innerHTML=`
        <h3>${t.asset}</h3>
        <b>${t.direction}</b><br>
        Entry: ${t.entry}<br>
        TP: ${t.tp}<br>
        SL: ${t.sl}
        <div id="chart${i}" class="chart-container"></div>
        `;

        container.appendChild(card);

        createChart(`chart${i}`,t.asset);
    });
}

async function createChart(containerId,symbol){

    const chart=LightweightCharts.createChart(
        document.getElementById(containerId),
        { width:350,height:150,layout:{background:{color:'#020617'},textColor:'#fff'} }
    );

    const candleSeries=chart.addCandlestickSeries();

    const response=await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=15m&limit=50`);
    const data=await response.json();

    const formatted=data.map(d=>({
        time:d[0]/1000,
        open:parseFloat(d[1]),
        high:parseFloat(d[2]),
        low:parseFloat(d[3]),
        close:parseFloat(d[4])
    }));

    candleSeries.setData(formatted);
}

async function loadAnalytics(){

    const res=await fetch('/api/analytics');
    const data=await res.json();

    document.getElementById("dashboard").innerHTML=`
    <div class="card">
    <h3>Performance Dashboard</h3>
    <div class="dashboard">
        <div class="metric">Winrate<br><b>${data.winrate}%</b></div>
        <div class="metric">Expectancy<br><b>${data.expectancy}</b></div>
        <div class="metric">Avg RR<br><b>${data.avg_rr}</b></div>
        <div class="metric">Edge Score<br><b>${data.edge_score}%</b></div>
    </div>
    <br>
    <span class="badge ${data.edge_grade}">
        ${data.edge_grade}
    </span>
    </div>`;
}

</script>

</body>
</html>
