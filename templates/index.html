<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quantum Institutional Engine</title>
<style>
body{margin:0;font-family:Arial;background:#0f172a;color:white}
header{padding:20px;text-align:center;font-size:24px;background:#111827}
button,input{padding:8px;border-radius:6px;border:none;margin:5px}
.card{background:#1e293b;padding:15px;border-radius:10px;margin:10px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr))}
</style>
</head>
<body>

<header>Quantum Institutional Engine</header>

<div style="padding:15px;">
<input type="number" id="account" value="1000">
<input type="number" id="risk" value="1">
<button onclick="generate()">Generate</button>
<button onclick="heatmap()">Heatmap</button>
<button onclick="correlation()">Correlation</button>
<button onclick="analytics()">Analytics</button>
</div>

<div id="output" class="grid"></div>

<script>

function notify(msg){
    if(Notification.permission==="granted"){
        new Notification(msg);
    }
}

if(Notification.permission!=="granted"){
    Notification.requestPermission();
}

async function generate(){
    const account=document.getElementById("account").value;
    const risk=document.getElementById("risk").value;

    const res=await fetch(`/api/scan?account=${account}&risk=${risk}`);
    const data=await res.json();

    const container=document.getElementById("output");
    container.innerHTML="";

    if(data.results){
        data.results.forEach(t=>{
            notify("New Trade: "+t.asset+" "+t.direction);
            container.innerHTML+=`
            <div class="card">
            ${t.asset} ${t.direction}<br>
            Entry: ${t.entry}<br>
            TP: ${t.tp}<br>
            SL: ${t.sl}<br>
            Size: ${t.size}
            </div>`;
        });
    } else {
        container.innerHTML=data.message;
    }
}

async function heatmap(){
    const res=await fetch('/api/heatmap');
    const data=await res.json();
    const container=document.getElementById("output");
    container.innerHTML="";
    data.heatmap.forEach(h=>{
        container.innerHTML+=`
        <div class="card">
        ${h.asset} - ${h.status}
        </div>`;
    });
}

async function correlation(){
    const res=await fetch('/api/correlation');
    const data=await res.json();
    const container=document.getElementById("output");
    container.innerHTML="<div class='card'>Correlation Matrix</div>";
    for(let a in data.matrix){
        for(let b in data.matrix[a]){
            container.innerHTML+=`
            <div class="card">
            ${a} vs ${b}: ${data.matrix[a][b]}
            </div>`;
        }
    }
}

async function analytics(){
    const res=await fetch('/api/analytics');
    const data=await res.json();
    const container=document.getElementById("output");
    container.innerHTML=`
    <div class="card">
    Winrate: ${data.winrate}%<br>
    Expectancy: ${data.expectancy}<br>
    Avg RR: ${data.avg_rr}<br>
    Edge Score: ${data.edge_score}%<br>
    Grade: ${data.edge_grade}
    </div>`;
}

</script>

</body>
</html>
